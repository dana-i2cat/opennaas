<?xml version="1.0" encoding="UTF-8"?>
<blueprint 
	xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0" 
    xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd 
 						http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.1.0 
						http://aries.apache.org/schemas/blueprint-cm/blueprint-cm-1.1.0.xsd">
	
	<!-- need to disambiguate between the two property-placeholder definitions by assigning 
	a unique placeholder prefix/suffix to them. 
	The default values are "${" for the prefix and "}" for the suffix -->
	<cm:property-placeholder persistent-id="org.opennaas" update-strategy="none" />
	<cm:property-placeholder persistent-id="org.opennaas.extensions.contentprovisioning" 
	placeholder-prefix="${cp:" update-strategy="none" />

	<!-- Get a reference to OpenNaaS resource manager service -->
	<reference id="resourceManager" interface="org.opennaas.core.resources.IResourceManager"/>

	<!-- Create content provisioning bean and OSGi service -->
	<bean id="contentProvisioning" class="org.opennaas.extensions.contentprovisioning.ContentProvisioning" >
		<property name="rm" ref="resourceManager" />
		<property name="switchResourceName" value="${cp:org.opennaas.contentprovisioning.switchName}" />
		<property name="flowInputPort" value="${cp:org.opennaas.contentprovisioning.switchInputPort}" />
		<property name="flowOutputPort" value="${cp:org.opennaas.contentprovisioning.switchOutputPort}" />
	</bean>
	<service ref="contentProvisioning" interface="org.opennaas.extensions.contentprovisioning.IContentProvisioning">
		<service-properties>
			<!-- Rest -->
			<entry key="service.exported.interfaces" value="*"/>
			<entry key="service.exported.configs" value="org.apache.cxf.rs"/>
			<entry key="service.exported.intents" value="HTTP"/>
			<entry key="org.apache.cxf.rs.httpservice.context" value="${ws.rest.url}/contentprovisioning"/>
			<entry key="org.apache.cxf.rs.address" value="/"/>
			<entry key="org.apache.cxf.httpservice.requirefilter" value="true"/>
		</service-properties>
	</service>
	
</blueprint>
